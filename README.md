# takken_3

## CSVインポートガイド

テンプレートの取得からアップロード、バリデーション結果の確認までの流れをまとめました。ホーム画面と設定画面のクイックインポート説明でも同じ手順を案内しています。

- テンプレートZIPから questions.csv / answers.csv をダウンロードする
- 年度・問番・問題文などの必須列を埋め、Excel などで保存する
- 『設定 ＞ データ入出力』またはホームのクイックインポートでファイルをアップロードする
- バリデーション結果でエラー行を確認し、必要に応じて再修正する
- 正常に取り込めたらTF-IDFの再学習や履歴エクスポートを活用する

CSV取り込み手順の動画ガイドはこちら: [https://takken.app/videos/csv-import-guide.mp4](https://takken.app/videos/csv-import-guide.mp4)

## 開発者向けチェック

GitHub Actions の [CI ワークフロー](.github/workflows/ci.yml) は、以下の順序で品質チェックを実行します。

1. `requirements.txt` の依存関係をインストール
2. `ruff check .` による静的解析
3. `pytest` によるユニットテスト

同じ手順をローカルで再現する場合は、次のコマンドを実行してください。

```bash
pip install -r requirements.txt
ruff check .
pytest
```

## 手動確認: キーボードショートカット

キーボードショートカットの挙動は Streamlit の DOM に依存するため、自動テストが難しいケースです。以下の手順で手動確認できます。

1. `streamlit run app.py` を実行し、演習画面で任意の問題を表示します。
2. 1〜4 キーで選択肢が切り替わること、`E` キーで解説の表示/非表示が切り替わること、`F` キーで復習フラグがトグルされることを確認します。
3. 進むボタンが存在する場合は `Enter` キーで次の問題に移動し、最終問題など「次へ」が無効な場合は `Enter` キーで「採点」ボタンが押下されることを確認します。
4. `H` キーでショートカット一覧のポップオーバーが開閉し、案内文に `Enter` の説明が表示されていることを確認します。

## データ入出力画面の管理パスワード設定

設定 > データ入出力では、テンプレートのダウンロードや大量のデータ更新が可能なため、管理パスワードによる保護が必要です。以下のいずれかの方法で `DATA_IO_PASSWORD` を設定してください。

- Streamlit の secrets に `DATA_IO_PASSWORD = "your-password"` を追加する (`.streamlit/secrets.toml` など)。
- サーバーの環境変数に `DATA_IO_PASSWORD` をセットする（例: `export DATA_IO_PASSWORD="your-password"`）。

パスワードを設定しない場合は、アプリが既定値 `12211221` を使用します。運用環境では固有の値に変更してください。

アプリ起動後、データ入出力画面の冒頭に表示されるパスワード入力欄に値を入力すると、認証されたセッションでのみダウンロード・インポート・リセット機能が利用できます。パスワードが未設定の場合は画面全体が無効化されるため、運用前に必ず設定してください。
