# 中期機能拡張ロードマップ

本ドキュメントでは、宅建学習支援アプリの中期的な機能拡張案を整理する。対象期間は今後3〜6か月を想定し、学習体験の向上と運用効率の改善を両立させることを目的とする。

## 1. 統計ダッシュボードの強化

- **目的**: 学習状況を可視化し、改善点を即座に把握できるようにする。
- **主要指標**: カテゴリ別正答率、平均解答時間、直近7日・30日推移。
- **UI案**:
  - 折れ線グラフで正答率と解答時間の推移を表示。
  - カテゴリ×週次のヒートマップで弱点領域をハイライト。
  - ホーム画面に簡易ウィジェットを表示し、主要指標を常時確認可能にする。
- **技術検討**:
  - Streamlit の `st.line_chart` / `st.area_chart`、`plotly` 連携によるヒートマップ描画。
  - 既存 `attempts` テーブルからカテゴリ別集計ロジックを SQLAlchemy 経由で実装。
  - ホーム画面のレイアウトをカード型に刷新し、レスポンシブ対応と合わせて実装する。
- **モニタリング**: 新指標の算出ジョブをバッチ化し、毎日早朝に更新。

## 2. 学習計画リコメンド

- **目的**: ユーザーが学習計画を立てる負荷を下げ、継続率を高める。
- **機能概要**:
  - 過去の正答率・解答時間・SRS(Spaced Repetition)データに基づく優先度算出。
  - SM-2 アルゴリズムと連携し、今週復習すべき問題セットを自動生成。
  - カレンダー（Google / iCal 形式）へのエクスポート機能。
- **実装ポイント**:
  - `questions_srs` テーブルから復習予定を計算するバックエンド関数を追加。
  - リコメンド結果をカードUIで提示し、カテゴリ・問題数・予想所要時間を表示。
  - エクスポート用に `ics` ライブラリを導入し、予定ファイルをダウンロード提供。
- **追加データ**:
  - 学習目標（週あたり学習時間/問題数）のユーザー設定フィールドを追加する。

## 3. モバイル対応とレスポンシブデザイン

- **課題**: 現状 PC 前提の画面設計でスマートフォンでは操作が難しい。
- **対策**:
  - UI フレームワークとして Tailwind CSS または Bootstrap の導入を検討。
  - ナビゲーションをドロワー型に変更し、片手操作で主要アクションが届く配置にする。
  - フォントサイズスケール設定 (`FONT_SIZE_SCALE`) を活かしたレスポンシブ調整。
- **確認事項**: 主要端末（iPhone 13 / Pixel 7 相当）のビューポートでの操作性テスト。

## 4. ゲーミフィケーション要素

- **目的**: やる気と継続率を高めるためのモチベーション設計。
- **要素案**:
  - 正答率、継続日数、連続正答数に応じたバッジ付与。
  - 匿名ニックネームで参加する正答率ランキング・挑戦回数ランキング。
  - 週間チャレンジ（例: 「宅建業法を20問解く」）の達成状況表示。
- **実装検討**:
  - `attempts` テーブルを利用したバッジ条件判定のバッチ処理。
  - ランキング算出のための集計ビュー、プライバシー保護のための匿名化ロジック。
  - 通知（メール/アプリ内）でバッジ獲得を知らせ、継続ログを強化。

## 5. 問題作成・編集インターフェース

- **目的**: 教材整備の内製化と改善サイクルの高速化。
- **機能案**:
  - Webフォームで新規問題の追加・既存問題の編集、プレビュー機能を提供。
  - Markdown 入力をサポートし、表・画像・リンクの挿入を容易にする。
  - CSV アップロードの結果を即時プレビューし、差分を確認してから確定できるワークフロー。
- **技術検討**:
  - Streamlit の `st.form` を活用した段階的入力、`st.markdown` によるプレビュー表示。
  - 画像は一時保存ディレクトリ（`UPLOAD_DIR`）にアップロードし、承認後に本保存。
  - 監査ログとして `import_logs` に Web 経由の操作も記録する。

## 6. 類似問題・参照条文へのリンク

- **目的**: 問題演習から一次情報へ自然に導線を設け、理解深化を支援する。
- **仕様案**:
  - 解説画面に関連条文・判例・外部資料へのリンクを表示。
  - e-Gov 法令検索、国立国会図書館デジタルコレクションの URL を自動生成。
  - 類似問題推薦では TF-IDF / コサイン類似度 (`TfidfVectorizer`, `cosine_similarity`) を活用。
- **実装ポイント**:
  - 問題データに条文番号・関連キーワードをメタデータとして付与し、リンク生成テンプレートを作成。
  - 類似度スコアに基づき上位3件を表示し、難易度やカテゴリを併記。
  - 外部リンクは別タブで開く設定とし、ユーザーに注意喚起する。

---

## 実行優先度とロードマップ

| フェーズ | 期間 | 主なマイルストーン |
|----------|------|----------------------|
| Phase 1  | 0〜2か月 | ダッシュボード刷新、モバイル対応のベータ版リリース |
| Phase 2  | 2〜4か月 | 学習計画リコメンド MVP、ゲーミフィケーション初期実装 |
| Phase 3  | 4〜6か月 | 問題作成フォーム本稼働、類似問題リンク機能ローンチ |

各フェーズ完了後にユーザーテストを実施し、改善案を次フェーズに反映させる。これにより、学習体験の継続的な向上と、教材開発・運用の効率化を両立することを目指す。
